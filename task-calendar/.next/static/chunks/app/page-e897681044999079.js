(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2958:function(e,t,a){Promise.resolve().then(a.bind(a,5667))},5667:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var r=a(7821),s=a(8078),l=a(97),n=a(5179),o=a(3262),c=a(3253),i=a(1507),d=a(1424),u=a(873),h=a(8077),m=function(e){let{tasks:t,selectedDate:a,onDateSelect:m,onTaskComplete:x,onTaskEdit:g,onTaskDelete:p}=e,[y,b]=(0,s.useState)(new Date),{monthStart:f,monthEnd:j,daysInMonth:v,firstDayOfWeek:N,emptyDays:w,monthYear:k}=(0,s.useMemo)(()=>{let e=(0,l.Z)(y),t=(0,n.Z)(y),a=(0,o.Z)({start:e,end:t}),r=e.getDay(),s=Array(r).fill(null);return{monthStart:e,monthEnd:t,daysInMonth:a,firstDayOfWeek:r,emptyDays:s,monthYear:(0,c.Z)(y,"MMMM yyyy")}},[y]),C=(0,s.useMemo)(()=>{let e=new Map;for(let a of t){let t=(0,c.Z)(new Date(a.dueDate),"yyyy-MM-dd"),r=e.get(t)||[];r.push(a),e.set(t,r)}return e},[t]),S=e=>{let t=(0,c.Z)(e,"yyyy-MM-dd");return C.get(t)||[]};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("button",{onClick:()=>b((0,i.Z)(y,1)),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold shadow-md","aria-label":"Previous month",children:"← Prev"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:k}),(0,r.jsx)("button",{onClick:()=>b((0,d.Z)(y,1)),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold shadow-md","aria-label":"Next month",children:"Next →"})]}),(0,r.jsx)("div",{className:"grid grid-cols-7 gap-2 mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,r.jsx)("div",{className:"text-center font-semibold text-gray-800 py-2",children:e},e))}),(0,r.jsxs)("div",{className:"grid grid-cols-7 gap-2",children:[w.map((e,t)=>(0,r.jsx)("div",{className:"h-24"},"empty-".concat(t))),v.map(e=>{let t=(0,c.Z)(e,"yyyy-MM-dd"),s=S(e),l=s.length>0?{total:s.length,completed:s.filter(e=>e.completed).length}:null,n=(0,u.Z)(e,a),o=(0,h.Z)(e,y),i=e.getDate();return(0,r.jsxs)("div",{onClick:()=>m(e),className:"\n                h-24 border-2 rounded-lg p-2 cursor-pointer transition\n                ".concat(n?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300","\n                ").concat(o?"":"opacity-50","\n              "),children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,r.jsx)("span",{className:"text-sm font-semibold ".concat(n?"text-blue-600":"text-gray-900"),children:i}),l&&(0,r.jsxs)("span",{className:"text-xs px-1.5 py-0.5 rounded ".concat(l.completed===l.total?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:[l.completed,"/",l.total]})]}),(0,r.jsxs)("div",{className:"space-y-1 overflow-y-auto max-h-16",children:[s.slice(0,3).map(e=>(0,r.jsx)("div",{onClick:t=>{t.stopPropagation(),g(e)},className:"\n                      text-xs p-1 rounded truncate cursor-pointer\n                      ".concat(e.completed?"bg-green-200 text-green-800 line-through":"bg-blue-100 text-blue-800","\n                    "),title:e.title,children:e.title},e.id)),s.length>3&&(0,r.jsxs)("div",{className:"text-xs text-gray-700",children:["+",s.length-3," more"]})]})]},t)})]}),(0,r.jsxs)("div",{className:"mt-6 border-t pt-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Tasks for ",(0,c.Z)(a,"MMMM d, yyyy")]}),(0,r.jsx)("div",{className:"space-y-2",children:(()=>{let e=S(a);return 0===e.length?(0,r.jsx)("p",{className:"text-gray-700",children:"No tasks for this date"}):e.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[(0,r.jsx)("input",{type:"checkbox",checked:e.completed,onChange:t=>x(e.id,t.target.checked),className:"w-5 h-5 text-blue-600 rounded"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-medium ".concat(e.completed?"line-through text-gray-500":"text-gray-900"),children:e.title}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-700",children:e.description}),e.child&&(0,r.jsxs)("p",{className:"text-xs text-gray-700",children:["Assigned to: ",e.child.name]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>g(e),className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"Edit"}),(0,r.jsx)("button",{onClick:()=>{confirm('Are you sure you want to delete "'.concat(e.title,'"?'))&&p(e.id)},className:"px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200",children:"Delete"})]})]},e.id))})()})]})]})};function x(e){let{task:t,childrenList:a,onSave:l,onCancel:n,onDelete:o}=e,[i,d]=(0,s.useState)(""),[u,h]=(0,s.useState)(""),[m,x]=(0,s.useState)((0,c.Z)(new Date,"yyyy-MM-dd")),[g,p]=(0,s.useState)(!1),[y,b]=(0,s.useState)(""),[f,j]=(0,s.useState)(""),[v,N]=(0,s.useState)([]);(0,s.useEffect)(()=>{C(),t&&(d(t.title),h(t.description||""),x((0,c.Z)(new Date(t.dueDate),"yyyy-MM-dd")),b(t.childId),j(t.recurrenceTemplateId||""),p(!1))},[t]);let w=v.find(e=>e.id===f),k=w&&"one-time"!==w.frequency,C=async()=>{try{let e=await fetch("/api/recurrence-templates"),t=await e.json();N(t)}catch(e){console.error("Error fetching recurrence templates:",e)}},S=async e=>{e.preventDefault();try{let e=t?"/api/tasks/".concat(t.id):"/api/tasks",a=t?"PUT":"POST",r=null;r=g&&k?new Date(new Date().setFullYear(new Date().getFullYear()+10)).toISOString():new Date(m).toISOString();let s=await fetch(e,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify({title:i,description:u,dueDate:r,childId:y,recurrenceTemplateId:f||null})});if(s.ok)l();else{let e=await s.json();alert("Error: ".concat(e.message||"Failed to save task"))}}catch(e){console.error("Error saving task:",e),alert("Failed to save task")}},T=async()=>{if(t&&o&&confirm('Are you sure you want to delete "'.concat(t.title,'"?')))try{(await fetch("/api/tasks/".concat(t.id),{method:"DELETE"})).ok?l():alert("Failed to delete task")}catch(e){console.error("Error deleting task:",e),alert("Failed to delete task")}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:t?"Edit Task":"Create New Task"}),(0,r.jsxs)("form",{onSubmit:S,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Title *"}),(0,r.jsx)("input",{type:"text",value:i,onChange:e=>d(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Description"}),(0,r.jsx)("textarea",{value:u,onChange:e=>h(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white"})]}),(!w||"one-time"===w.frequency)&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Due Date *"}),(0,r.jsx)("input",{type:"date",value:m,onChange:e=>x(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white"})]}),k&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Due Date"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:g,onChange:e=>{p(e.target.checked),e.target.checked||x((0,c.Z)(new Date,"yyyy-MM-dd"))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,r.jsx)("span",{className:"text-gray-900 font-medium",children:"Open-Ended (No Due Date)"})]}),!g&&(0,r.jsx)("input",{type:"date",value:m,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-700 mt-1",children:g?"This task will repeat indefinitely on the scheduled days":"Set a specific end date for this recurring task"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Assign to Child *"}),(0,r.jsxs)("select",{value:y,onChange:e=>b(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white",children:[(0,r.jsx)("option",{value:"",children:"Select a child"}),a.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Recurrence Template (Optional)"}),(0,r.jsxs)("select",{value:f,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white",children:[(0,r.jsx)("option",{value:"",children:"None"}),v.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," (",e.frequency,")"]},e.id))]})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[t&&o&&(0,r.jsx)("button",{type:"button",onClick:T,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Delete"}),(0,r.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:t?"Update Task":"Create Task"}),(0,r.jsx)("button",{type:"button",onClick:n,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})}function g(e){let{onClose:t,childrenList:a}=e,[l,n]=(0,s.useState)([]),[o,i]=(0,s.useState)(!1),[d,u]=(0,s.useState)(null),[h,m]=(0,s.useState)(""),[x,g]=(0,s.useState)("one-time"),[p,y]=(0,s.useState)([]),[b,f]=(0,s.useState)(1),[j,v]=(0,s.useState)((0,c.Z)(new Date,"yyyy-MM-dd")),[N,w]=(0,s.useState)("");(0,s.useEffect)(()=>{k()},[]);let k=async()=>{try{let e=await fetch("/api/recurrence-templates"),t=await e.json();n(t)}catch(e){console.error("Error fetching templates:",e)}},C=async e=>{e.preventDefault();try{let e=d?"/api/recurrence-templates/".concat(d.id):"/api/recurrence-templates",t=a.find(e=>e.id===N);if(!t){alert("Please select a child");return}let r=await fetch(e,{method:d?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name,description:h,frequency:x,daysOfWeek:"weekly"===x?p:null,dayOfMonth:"monthly"===x?b:null,dueDate:"one-time"===x?new Date(j).toISOString():null,childId:N||null})});if(r.ok)k(),D();else{let e=await r.json();alert("Error: ".concat(e.message||"Failed to save template"))}}catch(e){console.error("Error saving template:",e),alert("Failed to save template")}},S=e=>{u(e),m(e.description||""),g(e.frequency),y(e.daysOfWeek||[]),f(e.dayOfMonth||1),w(e.childId||""),e.dueDate?v((0,c.Z)(new Date(e.dueDate),"yyyy-MM-dd")):v((0,c.Z)(new Date,"yyyy-MM-dd")),i(!0)},T=async e=>{if(confirm("Are you sure you want to delete this template?"))try{(await fetch("/api/recurrence-templates/".concat(e),{method:"DELETE"})).ok?k():alert("Failed to delete template")}catch(e){console.error("Error deleting template:",e),alert("Failed to delete template")}},D=()=>{i(!1),u(null),m(""),g("one-time"),y([]),f(1),v((0,c.Z)(new Date,"yyyy-MM-dd")),w("")},M=e=>{y(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e].sort())},E=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Recurrence Templates"}),(0,r.jsx)("button",{onClick:t,className:"text-gray-700 hover:text-gray-900 text-2xl",children:"\xd7"})]}),o?(0,r.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:d?"Edit Template":"Create New Template"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Child Name * (Template will use this name)"}),(0,r.jsxs)("select",{value:N,onChange:e=>w(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white",children:[(0,r.jsx)("option",{value:"",children:"Select a child..."}),a.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Frequency *"}),(0,r.jsxs)("select",{value:x,onChange:e=>g(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white",children:[(0,r.jsx)("option",{value:"one-time",children:"One-Time (No Recurrence)"}),(0,r.jsx)("option",{value:"weekly",children:"Weekly (Repeat on Selected Days)"}),(0,r.jsx)("option",{value:"monthly",children:"Monthly (Same Day Each Month)"})]})]}),"weekly"===x&&(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-3",children:"Select Days of Week * (Choose which days to repeat weekly)"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-3",children:E.map((e,t)=>(0,r.jsxs)("label",{className:"flex items-center space-x-3 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-white hover:border-blue-400 transition bg-white",children:[(0,r.jsx)("input",{type:"checkbox",checked:p.includes(t),onChange:()=>M(t),className:"w-5 h-5 text-blue-600 border-gray-400 rounded focus:ring-blue-500 focus:ring-2"}),(0,r.jsx)("span",{className:"text-gray-900 font-semibold text-base",children:e})]},t))}),0===p.length&&(0,r.jsx)("p",{className:"text-sm text-red-600 font-medium mt-3",children:"⚠️ Please select at least one day"}),p.length>0&&(0,r.jsxs)("p",{className:"text-sm text-green-600 font-medium mt-3",children:["✓ Selected: ",p.map(e=>E[e]).join(", ")]})]}),"monthly"===x&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Day of Month (1-31) *"}),(0,r.jsx)("input",{type:"number",min:"1",max:"31",value:b,onChange:e=>f(parseInt(e.target.value)),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white"})]}),"one-time"===x&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Due Date *"}),(0,r.jsx)("input",{type:"date",value:j,onChange:e=>v(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white"})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:d?"Update Template":"Create Template"}),(0,r.jsx)("button",{type:"button",onClick:D,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Cancel"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>i(!0),className:"mb-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Create New Template"}),(0,r.jsx)("div",{className:"space-y-2",children:0===l.length?(0,r.jsx)("p",{className:"text-gray-900",children:"No recurrence templates yet"}):l.map(e=>(0,r.jsxs)("div",{className:"p-4 border border-gray-200 rounded-lg flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-900",children:e.description}),e.child&&(0,r.jsxs)("p",{className:"text-sm text-gray-900 font-medium mt-1",children:["Child: ",e.child.name]}),(0,r.jsxs)("p",{className:"text-sm text-gray-900 mt-1",children:["Frequency: ","one-time"===e.frequency?"One-Time (No Recurrence)":e.frequency,"weekly"===e.frequency&&e.daysOfWeek&&e.daysOfWeek.length>0&&(0,r.jsxs)("span",{children:[" (Days: ",e.daysOfWeek.map(e=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e]).join(", "),")"]}),"monthly"===e.frequency&&null!=e.dayOfMonth&&(0,r.jsxs)("span",{children:[" (Day ",e.dayOfMonth," of each month)"]}),"one-time"===e.frequency&&e.dueDate&&(0,r.jsxs)("span",{children:[" - Due: ",(0,c.Z)(new Date(e.dueDate),"MMM d, yyyy")]}),("weekly"===e.frequency||"monthly"===e.frequency)&&(0,r.jsx)("span",{className:"text-green-700 font-medium",children:" (Open-Ended)"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>S(e),className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"Edit"}),(0,r.jsx)("button",{onClick:()=>T(e.id),className:"px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200",children:"Delete"})]})]},e.id))})]})]})})}function p(e){let{childrenList:t,onChildAdded:a}=e,[l,n]=(0,s.useState)(!1),[o,c]=(0,s.useState)(""),i=async e=>{e.preventDefault();try{let e=await fetch("/api/children",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o})});if(e.ok)c(""),n(!1),a();else{let t=await e.json();alert("Error: ".concat(t.error||"Failed to add child"))}}catch(e){console.error("Error adding child:",e),alert("Failed to add child")}};return l?(0,r.jsx)("div",{className:"mb-4 p-4 bg-white rounded-lg border border-gray-200",children:(0,r.jsxs)("form",{onSubmit:i,className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:o,onChange:e=>c(e.target.value),placeholder:"Child's name",required:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-gray-900 bg-white placeholder-gray-400"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add"}),(0,r.jsx)("button",{type:"button",onClick:()=>{n(!1),c("")},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Cancel"})]})}):(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Add Child"}),t.length>0&&(0,r.jsxs)("div",{className:"mt-2 text-sm text-gray-900",children:["Children: ",t.map(e=>e.name).join(", ")]})]})}function y(e){let{childrenList:t,onTimeUpdated:a}=e,[l,n]=(0,s.useState)(""),[o,c]=(0,s.useState)(15),[i,d]=(0,s.useState)("add"),[u,h]=(0,s.useState)(!1),m=t.find(e=>e.id===l),x=e=>{let t=Math.floor(Math.abs(e)/60),a=Math.abs(e)%60,r=e<0?"-":"";return 0===t?"".concat(r).concat(a,"m"):0===a?"".concat(r).concat(t,"h"):"".concat(r).concat(t,"h ").concat(a,"m")},g=async e=>{if(e.preventDefault(),!l){alert("Please select a child");return}h(!0);try{let e="add"===i?o:-o,t=await fetch("/api/children/".concat(l,"/time"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({minutes:e})});if(t.ok)a(),c(15),d("add");else{let e=await t.json();alert("Error: ".concat(e.error||"Failed to update time"))}}catch(e){console.error("Error updating time:",e),alert("Failed to update time")}finally{h(!1)}};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Time Tracker"}),(0,r.jsxs)("form",{onSubmit:g,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Select Child *"}),(0,r.jsxs)("select",{value:l,onChange:e=>n(e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white",children:[(0,r.jsx)("option",{value:"",children:"Choose a child..."}),t.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," ",0!==e.timeBalance&&"(".concat(x(e.timeBalance),")")]},e.id))]})]}),m&&(0,r.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-sm text-gray-900 mb-1 font-medium",children:"Current Balance:"}),(0,r.jsx)("p",{className:"text-2xl font-bold ".concat(m.timeBalance>=0?"text-green-600":"text-red-600"),children:x(m.timeBalance)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Operation *"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",value:"add",checked:"add"===i,onChange:e=>d(e.target.value),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),(0,r.jsx)("span",{className:"text-gray-900 font-medium",children:"Add Time"})]}),(0,r.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",value:"subtract",checked:"subtract"===i,onChange:e=>d(e.target.value),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),(0,r.jsx)("span",{className:"text-gray-900 font-medium",children:"Subtract Time"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-1",children:"Time Amount (15-minute increments) *"}),(0,r.jsxs)("select",{value:o,onChange:e=>c(parseInt(e.target.value)),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white",children:[(0,r.jsx)("option",{value:15,children:"15 minutes"}),(0,r.jsx)("option",{value:30,children:"30 minutes"}),(0,r.jsx)("option",{value:45,children:"45 minutes"}),(0,r.jsx)("option",{value:60,children:"1 hour"}),(0,r.jsx)("option",{value:90,children:"1.5 hours"}),(0,r.jsx)("option",{value:120,children:"2 hours"}),(0,r.jsx)("option",{value:180,children:"3 hours"}),(0,r.jsx)("option",{value:240,children:"4 hours"})]})]}),(0,r.jsx)("button",{type:"submit",disabled:u||!l,className:"w-full px-4 py-2 rounded-lg transition font-semibold ".concat("add"===i?"bg-green-600 text-white hover:bg-green-700":"bg-red-600 text-white hover:bg-red-700"," disabled:opacity-50 disabled:cursor-not-allowed"),children:u?"Processing...":"".concat("add"===i?"Add":"Subtract"," ").concat(x(o))})]}),t.length>0&&(0,r.jsxs)("div",{className:"mt-6 pt-6 border-t",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"All Children's Time Balance"}),(0,r.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,r.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,r.jsx)("span",{className:"font-medium text-gray-900",children:e.name}),(0,r.jsx)("span",{className:"font-bold ".concat(e.timeBalance>=0?"text-green-600":"text-red-600"),children:x(e.timeBalance)})]},e.id))})]})]})}function b(e){let{onCacheCleared:t}=e,[a,l]=(0,s.useState)(!1),n=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=e=>{n.current&&!n.current.contains(e.target)&&l(!1)};return a&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[a]);let o=()=>{try{localStorage.clear(),sessionStorage.clear(),"caches"in window&&caches.keys().then(e=>{e.forEach(e=>{caches.delete(e)})}),alert("Cache cleared successfully! The page will reload."),l(!1),window.location.reload()}catch(e){console.error("Error clearing cache:",e),alert("Error clearing cache. Please try again.")}};return(0,r.jsxs)("div",{className:"relative",ref:n,children:[(0,r.jsx)("button",{onClick:()=>l(!a),className:"p-2 text-gray-800 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition","aria-label":"Settings",title:"Settings",children:(0,r.jsxs)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),a&&(0,r.jsx)("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-50",children:(0,r.jsxs)("div",{className:"py-1",children:[(0,r.jsxs)("button",{onClick:()=>{confirm("This will clear all cached application data. Are you sure?")&&(o(),t&&t())},className:"w-full text-left px-4 py-2 text-sm text-gray-900 hover:bg-gray-100 transition flex items-center gap-2 font-medium",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Clear Cache"]}),(0,r.jsx)("div",{className:"border-t border-gray-200 my-1"}),(0,r.jsx)("div",{className:"px-4 py-2 text-xs text-gray-700",children:"Clears browser cache and reloads the page"})]})})]})}function f(){let[e,t]=(0,s.useState)([]),[a,l]=(0,s.useState)([]),[n,o]=(0,s.useState)(new Date),[c,i]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),[h,f]=(0,s.useState)(null),[j,v]=(0,s.useState)(null),[N,w]=(0,s.useState)(!0);(0,s.useEffect)(()=>{k(),C()},[]);let k=async()=>{try{w(!0),v(null);let e=await fetch("/api/tasks");if(!e.ok){let t=await e.json().catch(()=>({error:"Unknown error"}));throw Error(t.error||"HTTP ".concat(e.status))}let a=await e.json();t(a),w(!1)}catch(e){console.error("Error fetching tasks:",e),v("Failed to load tasks: ".concat(e.message||e)),w(!1)}},C=async()=>{try{let e=await fetch("/api/children");if(!e.ok){let t=await e.json().catch(()=>({error:"Unknown error"}));throw Error(t.error||"HTTP ".concat(e.status))}let t=await e.json();l(t)}catch(e){console.error("Error fetching children:",e),v("Failed to load children: ".concat(e.message||e))}},S=async()=>{try{let e=await fetch("/api/tasks/check-daily-completion");e.ok&&(await e.json()).allComplete&&await fetch("/api/home-assistant/trigger",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:new Date().toISOString()})})}catch(e){console.error("Error checking daily completion:",e)}},T=async(e,t)=>{try{(await fetch("/api/tasks/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({completed:t})})).ok&&(await k(),await S())}catch(e){console.error("Error updating task:",e)}},D=async e=>{try{(await fetch("/api/tasks/".concat(e),{method:"DELETE"})).ok?await k():alert("Failed to delete task")}catch(e){console.error("Error deleting task:",e),alert("Failed to delete task")}};return(0,r.jsx)("main",{className:"min-h-screen p-8 bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-8 flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Task Calendar"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Track chores and tasks for your children"})]}),(0,r.jsx)(b,{})]}),j&&(0,r.jsxs)("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded",children:[(0,r.jsx)("p",{className:"font-bold",children:"Error:"}),(0,r.jsx)("p",{children:j}),(0,r.jsx)("button",{onClick:()=>{v(null),k(),C()},className:"mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry"})]}),N&&!j&&(0,r.jsx)("div",{className:"mb-4 p-4 bg-blue-100 border border-blue-400 text-blue-700 rounded",children:"Loading..."}),(0,r.jsx)(p,{childrenList:a,onChildAdded:C}),(0,r.jsx)(y,{childrenList:a,onTimeUpdated:C}),(0,r.jsxs)("div",{className:"mb-6 flex gap-4",children:[(0,r.jsx)("button",{onClick:()=>{f(null),i(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Add New Task"}),(0,r.jsx)("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:"Manage Recurrence Templates"})]}),(0,r.jsx)(m,{tasks:e,selectedDate:n,onDateSelect:o,onTaskComplete:T,onTaskEdit:e=>{f(e),i(!0)},onTaskDelete:D}),c&&(0,r.jsx)(x,{task:h,childrenList:a,onSave:()=>{k(),i(!1),f(null)},onCancel:()=>{i(!1),f(null)},onDelete:D}),d&&(0,r.jsx)(g,{onClose:()=>u(!1),childrenList:a})]})})}}},function(e){e.O(0,[450,115,364,744],function(){return e(e.s=2958)}),_N_E=e.O()}]);